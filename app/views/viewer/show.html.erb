
<% @def = @glossary.definition %>

<% @def.gsub!(/,/){"@"} %>

<% @terms = @terms.split(/,/) %>

<% @found = "0" %>
<% @termfound = "0" %>

<% @insert_num = 0 %>
<% @terms %>
<% @terms.each do |term| %>

  
  <% @def_str = @def.to_s%>

  <%  @regex = Regexp.new(/#{term}\w*/)%>
  <%  matchdata = @regex.match(@def_str)%>
  <%  if matchdata%>

    
    <%matchdata = matchdata.to_s%>

    <% @def = @def.to_s %>
    <% @def = @def.sub!(/#{term}\w*/){",#{@insert_num}"} %>
    
    <%@insert_num += 1%>

    <%  if @found == "0"%>
      <% @def = @def.split(/,/, 2) %>
      <% @found = matchdata%>
      <% @termfound = term %>
      <% @defar = @def.first+"," %>
      <% @def.shift %>
      <%@def = @def.to_s %>
    <%  else%>
      <%  @found << "," +matchdata%>
       <% @termfound << "," +term %>
    <%  end%>
  <%  end%>
<% end %>


<% @def = @def.split(/,/) %>
<% @def.each do |segment| %>
  <% @defar << segment+ ","%>
<%end%>

<%  unless @found == "0"%>
  <%  @found = @found.split(/,/)%>
  <%  @defar = @defar.split(/,/)%>
  <%  @termfound = @termfound.split(/,/)%>
  <%  index = 0..(@defar.length - 1)%>

  <%  index.each do |i|%>
    
    <% if @defar[i].first =~ /\d/ then insert = @defar[i].first else insert = "" end%>
    
    <% unless insert == "" then insert = insert.to_i end%>

    <%unless insert == "" then found = @found[insert] else found = "" end%>
    <%unless insert == "" then termfound = @termfound[insert] end%>
    <%if @defar[i] =~ /@/ then @defar[i] = @defar[i].gsub!(/@/){","} end %>
    <%if @defar[i] =~ /\d/ then @defar[i] = @defar[i].sub!(/\d/){""} end %>
    
    <%= link_to "#{found}", {:controller => :viewer, :action => :show, :term => "#{termfound}"}%>
    <%= @defar[i]%>
  <% end%>

<%  else%>
  <%= @def %>
<% end%>
